<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hasta Viejitos – Family Project</title>
  <style>
    :root { --bg:#0b0f14; --card:#121923; --muted:#9fb0c3; --text:#e6eef7; --accent:#63b3ed; }
    * { box-sizing:border-box; }
    body { margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; background:var(--bg); color:var(--text); }
    header { padding:24px; border-bottom:1px solid #1e2a38; }
    .wrap { max-width:1100px; margin:0 auto; padding:24px; }
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:16px; }
    .card { background:var(--card); border:1px solid #1e2a38; border-radius:16px; padding:16px; box-shadow:0 6px 20px rgba(0,0,0,.25); }
    .muted { color:var(--muted); font-size:14px; }
    .pill { display:inline-block; padding:2px 10px; border-radius:999px; border:1px solid #2a3b52; margin-right:6px; font-size:12px; color:var(--muted); }
    h1 { margin:0 0 6px 0; font-size:28px; }
    h2 { margin:0 0 12px 0; font-size:18px; }
    a { color:var(--accent); text-decoration:none; }
    .col { min-height: 180px; }
    .item { padding:10px 0; border-bottom:1px dashed #233247; }
    .item:last-child { border-bottom:0; }
    .empty { color:#8194aa; font-style:italic; }
  </style>
</head>
<body>
  <header class="wrap">
    <h1>Hasta Viejitos – Dashboard</h1>
    <div class="muted">Live snapshot from GitHub Issues (updated by Actions)</div>
  </header>

  <main class="wrap">
    <div class="grid">
      <div class="card">
        <h2>Summary</h2>
        <div class="muted" id="summary">Loading…</div>
        <div style="margin-top:8px">
          <span class="pill" id="openCount">open: –</span>
          <span class="pill" id="closedCount">closed: –</span>
          <span class="pill" id="urgentCount">urgent: –</span>
          <span class="pill" id="blockedCount">blocked: –</span>
        </div>
      </div>

      <div class="card col">
        <h2>Now</h2>
        <div id="nowList" class="muted">Loading…</div>
      </div>

      <div class="card col">
        <h2>Next</h2>
        <div id="nextList" class="muted">Loading…</div>
      </div>

      <div class="card col">
        <h2>Later</h2>
        <div id="laterList" class="muted">Loading…</div>
      </div>
    </div>
  </main>

  <script>
    async function load() {
      const res = await fetch("./data/issues.json", { cache: "no-store" });
      if (!res.ok) throw new Error("Failed to load issues.json");
      return res.json();
    }
    function renderList(el, items) {
      if (!items.length) { el.innerHTML = `<div class="empty">No items</div>`; return; }
      el.innerHTML = items.map(i => `
        <div class="item">
          <a href="${i.url}" target="_blank" rel="noopener">${i.title}</a>
          <div class="muted">#${i.number} • ${i.state}
            ${i.labels.map(l=>`<span class="pill">${l}</span>`).join(" ")}
          </div>
        </div>
      `).join("");
    }
    (async () => {
      try {
        const issues = await load();
        const open   = issues.filter(i => i.state === "open");
        const closed = issues.filter(i => i.state === "closed");
        const urgent = issues.filter(i => i.labels.map(n=>n.toLowerCase()).includes("urgent"));
        const blocked= issues.filter(i => i.labels.map(n=>n.toLowerCase()).includes("blocked"));

        document.getElementById("summary").textContent = `Tracking ${issues.length} issues`;
        document.getElementById("openCount").textContent   = `open: ${open.length}`;
        document.getElementById("closedCount").textContent = `closed: ${closed.length}`;
        document.getElementById("urgentCount").textContent = `urgent: ${urgent.length}`;
        document.getElementById("blockedCount").textContent= `blocked: ${blocked.length}`;

        const now   = open.filter(i => i.labels.includes("NOW"));
        const next  = open.filter(i => i.labels.includes("NEXT"));
        const later = open.filter(i => i.labels.includes("LATER"));

        renderList(document.getElementById("nowList"), now);
        renderList(document.getElementById("nextList"), next);
        renderList(document.getElementById("laterList"), later);
      } catch (e) {
        document.getElementById("summary").textContent = "Failed to load data. (Tip: run the Action once)";
        console.error(e);
      }
    })();
  </script>
</body>
</html>